<?xml version="1.0"?>
<project name="Generic Cache Processor" default="compile" basedir=".">
  <tstamp property="build.date" pattern="dd-MM-yyyy" verbose="true"/>
  <sysinfo verbose="true"/>

  <property name="main_project_folder" value="TopCoder.Util.GCP" />
  <property name="component" value="Generic Cache Processor" />
  <property name="distfilename" value="generic_cache_processor" />
  <property name="namespace" value="TopCoder\Util\GCP" />
  <property name="namespace_file" value="TopCoder.Util.GCP" />

  <property name="component_version" value="1.0" />

  <property name="copyright" value="Copyright (c) 2008, TopCoder, Inc. All rights reserved." />

  <!--  REFERENCE TO NUNIT -->
  <property name="Nunit" value="C:\Program Files\NUnit 2.4.3\.net-2.0\bin\nunit.framework.dll" />
  <property name="NunitConsole" value="C:\Program Files\NUnit 2.4.3\.net-2.0\bin\nunit-console.exe" />
  <property name="NDoc" value="D:\Program Files\NDoc2-Alpha3u\NDocConsole.exe"/>

  <!--  REFERENCE TO NCOVER -->
  <property name="NCoverHome" value="C:\Program Files\NCover"/>
  <property name="NCoverConsole" value="${NCoverHome}\NCover.Console.exe"/>
  <property name="NCoverStyle" value="${NCoverHome}\Coverage.xsl"/>

  <property name="debug" value="true"/>
  <property name="verbose" value="true" />
  <property name="component_path" value="${distfilename}\${component_version}" />

  <!-- directories -->
  <property name="builddir" value="build" />
  <property name="configdir" value="conf" />
  <property name="libdir" value="lib" />
  <property name="testlogdir" value="log" />
  <property name="testfiles" value="test_files" />
  <property name="tcs" value="..\tcs"/>

  <!-- Base directory for all third party components. -->
  <property name="ext_bin" value="${tcs}\bin"/>

  <!-- Base directory for all TCS components. -->
  <property name="tcs_bin" value="${ext_bin}\tcs"/>

  <!-- NUNIT's output needs to go back to the root these next two properties should correspond -->
  <property name="build_classdir" value="${builddir}\classes" />
  <property name="root_from_build_classdir" value="..\.." />
  <property name="TestOutputXml" value="${testlogdir}\${namespace_file}.Test.dll-results.xml"/>
  <property name="TestOutputText" value="${testlogdir}\${namespace_file}.Test.dll-results.log"/>

  <!-- NCover's output properties -->
  <property name="CoverageOutputXml" value="${testlogdir}\${namespace_file}.DeveloperTest.dll-coverage.xml"/>
  <property name="CoverageOutputStyleSheet" value="${testlogdir}\coverage.xsl"/>
  <property name="CoverageNunitXml" value="${testlogdir}\${namespace_file}.DeveloperTest.dll-coverage-unit.xml"/>
  <property name="CoverageLogFile" value="${testlogdir}\DeveloperNCover.log.txt"/>

  <!-- Include the global system settings.  The settings in this file will override any settings for the same properties
         included above this line, so if the global file is correct there is no need to edit this file. -->
  <include buildfile="../../topcoder_global.build" failonerror="false" />

  <!-- 3rd party dependencies -->
  <property name="log4net.dll" value="${ext_bin}\third_party\log4net\1.2.10\log4net.dll"/>


  <property name="system_addin.dll" value="c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.5\System.AddIn.dll" />
  <property name="system_addin_contract.dll" value="c:\Program Files\Reference Assemblies\Microsoft\Framework\v3.5\System.AddIn.Contract.dll" />

  <!-- TopCoder dependencies -->
  <property name="logging_wrapper.dll" value="${tcs_bin}\logging_wrapper\3.0\TopCoder.LoggingWrapper.dll" />
  <property name="configuration_api.dll" value="${tcs_bin}\configuration_api\1.0\TopCoder.Configuration.dll" />
  <property name="configuration_manager.dll" value="${tcs_bin}\configuration_manager\2.0.1\TopCoder.Util.ConfigurationManager.dll"/>
  <property name="exception_manager.dll" value="${tcs_bin}\exception_manager\1.0.1\TopCoder.Util.ExceptionManager.dll" />
  <property name="self-documenting_exception.dll" value="${tcs_bin}\self-documenting_exception\1.0.1\TopCoder.Util.ExceptionManager.SDE.dll" />
  <property name="object_factory.dll" value="${tcs_bin}\object_factory\1.2.1\TopCoder.Util.ObjectFactory.dll" />
  <property name="object_factory_configuration_api_plugin.dll" value="${tcs_bin}\object_factory_configuration_api_plugin\1.1\TopCoder.Util.ObjectFactory.Configuration.dll" />
  <property name="set_utility.dll" value="${tcs_bin}\set_utility\1.0\TopCoder.Util.Collection.Set.dll" />

  <!--   ****************************************************  -->

  <property name="build_contracts" value="${build_classdir}\contracts" />
  <property name="build_addinsideadapters" value="${build_classdir}\addinsideadapters" />
  <property name="build_addinviews" value="${build_classdir}\addinviews" />
  <property name="build_hostsideadapters" value="${build_classdir}\hostsideadapters" />
  <property name="build_hostsideviews" value="${build_classdir}" />
  <property name="build_testaddins" value="${build_classdir}\AddIns" />
  <property name="build_addinroot" value="${build_classdir}" />
  <property name="build_testclassdir" value="${builddir}\testClasses\" />
  <property name="build_distdir" value="${builddir}\dist" />
  <property name="build_tcsdistdir" value="${build_distdir}\${distfilename}-${component_version}" />
  <property name="build_docsdir" value="${builddir}\docs" />
  <property name="build_docpackage" value="${builddir}\doc_package" />
  <property name="testdocsresult_dir" value="${build_docsdir}\testResults" />

  <property name="build_xmldocsdir" value="${build_docsdir}\xmldoc\" />
  <property name="build_msdndir" value="${build_docsdir}\msdn" />

  <property name="msdnfile" value="msdndocs.zip" />
  <property name="docpackagefile" value="${distfilename}_docs.zip" />

  <property name="docsdir" value="docs" />

  <!-- Component distribution structure -->
  <property name="dist_conf" value="${build_tcsdistdir}\conf" />
  <property name="dist_test_files" value="${build_tcsdistdir}\test_files" />
  <property name="dist_bin" value="${build_distdir}\bin" />
  <property name="dist_examples" value="${build_tcsdistdir}\examples" />
  <property name="dist_docs" value="${build_tcsdistdir}\docs" />
  <property name="test_results" value="${dist_docs}\test_results" />
  <property name="msdn_docs" value="${dist_docs}\msdn_docs" />
  <property name="xml_docs" value="${dist_docs}\xml" />
  <property name="source_xml_docs" value="${xml_docs}\source" />
  <property name="test_xml_docs" value="${xml_docs}\tests" />
  <property name="component.zip" value="${dist_bin}\${component_path}\${distfilename}.zip"/>
  <property name="component_version_name.zip" value="${distfilename}-${component_version}.zip"/>
  <property name="component.dist.zip" value="${build_distdir}\${component_version_name.zip}"/>

  <property name="design_dist.zip" value="${distfilename}_${component_version}_design_dist.zip"/>
  <property name="dev_dist.zip" value="${distfilename}_${component_version}_dev_dist.zip"/>

  <property name="docs_coverage" value="${docsdir}\coverage" />
  <property name="dist_coverage" value="${build_tcsdistdir}\docs\coverage" />

  <!-- builds -->
  <property name="design_submission.zip" value="${distfilename}_${component_version}_design_submission.zip"/>
  <property name="dev_submission.zip" value="${distfilename}_${component_version}_dev_submission.zip"/>


  <target name="dist_docs">
    <mkdir dir="${source_xml_docs}"/>
    <mkdir dir="${test_xml_docs}"/>
    <mkdir dir="${test_results}"/>
    <mkdir dir="${msdn_docs}"/>
    <mkdir dir="${build_msdndir}"/>

    <copy file="${build_classdir}\${namespace_file}.xml" todir="${source_xml_docs}"/>
    <copy file="${build_classdir}\${namespace_file}.DeveloperTest.xml" todir="${test_xml_docs}"/>
    <copy file="${build_classdir}\${namespace_file}.AccuracyTest.xml" todir="${test_xml_docs}"/>
    <copy file="${build_classdir}\${namespace_file}.FailureTest.xml" todir="${test_xml_docs}"/>
    <copy file="${build_classdir}\${namespace_file}.StressTest.xml" todir="${test_xml_docs}"/>

    <copy todir="${test_results}">
      <fileset basedir="${testdocsresult_dir}" defaultexcludes="true">
        <include name="**/*"/>
        <exclude name="**/*.xml"/>
      </fileset>
    </copy>
    <copy todir="${msdn_docs}">
      <fileset basedir="${build_msdndir}" defaultexcludes="true">
        <include name="**/*"/>
        <exclude name="**/*.chm"/>
      </fileset>
    </copy>

    <!-- <copy file="${build_msdndir}\${distfilename}.chm" todir="${dist_docs}"/> -->
  </target>

  <target name="compile" >
    <mkdir dir="${build_classdir}"/>
    <mkdir dir="${build_docsdir}"/>
    <mkdir dir="${build_contracts}"/>
    <mkdir dir="${build_addinsideadapters}"/>
    <mkdir dir="${build_addinviews}"/>
    <mkdir dir="${build_hostsideadapters}"/>
    <mkdir dir="${build_hostsideviews}"/>
    <mkdir dir="${build_testaddins}\MyAggregator"/>
    <mkdir dir="${build_testaddins}\MyIndexer"/>
    <mkdir dir="${build_testaddins}\MyQueryParser"/>

    <!-- Common -->
    <csc target="library" output="${build_classdir}\${namespace_file}.Common.dll"
         doc="${build_classdir}\${namespace_file}.Common.xml" >
      <sources>
        <include name="${main_project_folder}.Common\**.cs" />
      </sources>
      <references>
        <include name="${Nunit}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${logging_wrapper.dll}"/>
        <include name="${configuration_manager.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
      </references>
    </csc>

    <!-- Host View -->
    <csc target="library" output="${build_hostsideviews}\${namespace_file}.HostView.dll"
         doc="${build_hostsideviews}\${namespace_file}.HostView.xml" >
      <sources>
        <include name="${main_project_folder}.HostView\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
      </references>
    </csc>

    <!-- Main Component -->
    <csc target="library" output="${build_classdir}\${namespace_file}.dll" doc="${build_classdir}\${namespace_file}.xml" >
      <sources>
        <include name="${main_project_folder}\**.cs"/>
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${logging_wrapper.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${object_factory_configuration_api_plugin.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_classdir}\${namespace_file}.HostView.dll" />
      </references>
    </csc>

    <!-- Contracts -->
    <csc target="library" output="${build_contracts}\${namespace_file}.Contracts.dll"
         doc="${build_contracts}\${namespace_file}.Contracts.xml" >
      <sources>
        <include name="${main_project_folder}.Contracts\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
      </references>
    </csc>

    <!-- Add In View -->
    <csc target="library" output="${build_addinviews}\${namespace_file}.AddInView.dll"
         doc="${build_addinviews}\${namespace_file}.AddInView.xml" >
      <sources>
        <include name="${main_project_folder}.AddInView\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
      </references>
    </csc>

    <!-- Add In Side Adapters -->
    <csc target="library" output="${build_addinsideadapters}\${namespace_file}.AddInSideAdapters.dll"
         doc="${build_addinsideadapters}\${namespace_file}.AddInSideAdapters.xml" >
      <sources>
        <include name="${main_project_folder}.AddInSideAdapters\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_addinviews}\${namespace_file}.AddInView.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
      </references>
    </csc>

    <!-- Host Side Adapters -->
    <csc target="library" output="${build_hostsideadapters}\${namespace_file}.HostSideAdapters.dll"
         doc="${build_hostsideadapters}\${namespace_file}.HostSideAdapters.xml" >
      <sources>
        <include name="${main_project_folder}.HostSideAdapters\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_hostsideviews}\${namespace_file}.HostView.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
      </references>
    </csc>

    <!-- Aggregator AddIns -->
    <csc target="library" output="${build_testaddins}\MyAggregator\${namespace_file}.Addins.MyAggregator.dll"
         doc="${build_testaddins}\MyAggregator\MyAggregator.xml" >
      <sources>
        <include name="test_files\addinsroot\TopCoder.Util.GCP.Addins.MyAggregator\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_hostsideviews}\${namespace_file}.HostView.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
        <include name="${build_addinviews}\${namespace_file}.AddInView.dll" />
      </references>
    </csc>

    <!-- Indexer AddIns -->
    <csc target="library" output="${build_testaddins}\MyIndexer\${namespace_file}.Addins.MyIndexer.dll"
         doc="${build_testaddins}\MyIndexer\MyIndexer.xml" >
      <sources>
        <include name="test_files\addinsroot\TopCoder.Util.GCP.Addins.MyIndexer\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_hostsideviews}\${namespace_file}.HostView.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
        <include name="${build_addinviews}\${namespace_file}.AddInView.dll" />
      </references>
    </csc>

    <csc target="library" output="${build_testaddins}\MyQueryParser\${namespace_file}.Addins.MyQueryParser.dll"
         doc="${build_testaddins}\MyQueryParser\MyQueryParser.xml" >
      <sources>
        <include name="test_files\addinsroot\TopCoder.Util.GCP.Addins.MyQueryParser\**.cs" />
      </sources>
      <references>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${build_hostsideviews}\${namespace_file}.HostView.dll" />
        <include name="${build_contracts}\${namespace_file}.Contracts.dll" />
        <include name="${build_addinviews}\${namespace_file}.AddInView.dll" />
        <include name="${configuration_api.dll}"/>
      </references>
    </csc>
    <copy file="${build_classdir}\${namespace_file}.xml" todir="${build_docsdir}" />
    <copy file="${build_contracts}\${namespace_file}.Contracts.xml" todir="${build_docsdir}" />
    <copy file="${build_addinsideadapters}\${namespace_file}.AddInSideAdapters.xml" todir="${build_docsdir}" />
    <copy file="${build_addinviews}\${namespace_file}.AddInView.xml" todir="${build_docsdir}" />
    <copy file="${build_hostsideadapters}\${namespace_file}.HostSideAdapters.xml" todir="${build_docsdir}" />
    <copy file="${build_hostsideviews}\${namespace_file}.HostView.xml" todir="${build_docsdir}" />
  </target>

  <target name="clean">
    <mkdir dir="${builddir}"/>
    <mkdir dir="${dist_docs}"/>
    <delete verbose="${verbose}">
      <fileset defaultexcludes="false" >
        <include name="${builddir}/**/**"/>
        <include name="*.zip"/>
        <include name="${dist_docs}/**.zip"/>
      </fileset>
    </delete>
  </target>

  <target name="compile_tests" depends="compile">
    <mkdir dir="${build_testclassdir}"/>

    <echo message="Please make sure that Nunit 2.0 is installed."/>
    <echo message="The NUnit property is currently pointing to: ${Nunit}."/>
    <echo message="If this is incorrect please adjust the Nunit property to point to the correct location."/>

    <echo message="Compiling Developer Tests" />
    <csc target="library" doc="${build_classdir}\${namespace_file}.DeveloperTest.xml"
                          output="${build_classdir}\${namespace_file}.DeveloperTest.dll"
                          failonerror="true" debug="true">
      <sources>
        <include name="${main_project_folder}.DeveloperTests\**.cs" />
      </sources>
      <references>
        <include name="${Nunit}"/>
        <include name="${logging_wrapper.dll}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${configuration_manager.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${object_factory_configuration_api_plugin.dll}"/>
        <include name="${build_classdir}\${namespace_file}.dll" />
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
      </references>
    </csc>

    <echo message="Compiling Accuracy Tests" />
    <csc target="library" doc="${build_classdir}\${namespace_file}.AccuracyTest.xml"
                          output="${build_classdir}\${namespace_file}.AccuracyTest.dll"
                          failonerror="true" debug="true">
      <sources>
        <include name="${main_project_folder}.AccuracyTests\**.cs" />
      </sources>
      <references>
        <include name="${Nunit}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${configuration_manager.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${object_factory_configuration_api_plugin.dll}"/>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.dll" />
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
      </references>
    </csc>
    <copy file="${build_classdir}\${namespace_file}.AccuracyTest.xml" todir="${build_docsdir}" />

    <echo message="Compiling Failure Tests" />
    <csc target="library" doc="${build_classdir}\${namespace_file}.FailureTest.xml"
                          output="${build_classdir}\${namespace_file}.FailureTest.dll"
                          failonerror="true" debug="true">
      <sources>
        <include name="${main_project_folder}.FailureTests\**.cs" />
      </sources>
      <references>
        <include name="${Nunit}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${configuration_manager.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${object_factory_configuration_api_plugin.dll}"/>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
        <include name="${build_classdir}\${namespace_file}.dll" />
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
      </references>
    </csc>
    <copy file="${build_classdir}\${namespace_file}.FailureTest.xml" todir="${build_docsdir}" />

    <echo message="Compiling Stress Tests" />
    <csc target="library" doc="${build_classdir}\${namespace_file}.StressTest.xml"
                          output="${build_classdir}\${namespace_file}.StressTest.dll"
                          failonerror="true" debug="true">
      <sources>
        <include name="${main_project_folder}.StressTests\**.cs" />
      </sources>
      <references>
        <include name="${build_classdir}\${namespace_file}.dll" />
        <include name="${build_classdir}\${namespace_file}.Common.dll" />
        <include name="${Nunit}"/>
        <include name="${configuration_api.dll}"/>
        <include name="${configuration_manager.dll}"/>
        <include name="${exception_manager.dll}"/>
        <include name="${self-documenting_exception.dll}"/>
        <include name="${object_factory.dll}"/>
        <include name="${object_factory_configuration_api_plugin.dll}"/>
        <include name="${system_addin.dll}"/>
        <include name="${system_addin_contract.dll}"/>
      </references>
    </csc>
    <copy file="${build_classdir}\${namespace_file}.StressTest.xml" todir="${build_docsdir}" />
  </target>

  <target name="copy_dependencies">
    <mkdir dir="${build_classdir}" />

    <copy file="${configuration_api.dll}" todir="${build_classdir}" />
    <copy file="${configuration_manager.dll}" todir="${build_classdir}" />
    <copy file="${logging_wrapper.dll}" todir="${build_classdir}" />
    <copy file="${exception_manager.dll}" todir="${build_classdir}" />
    <copy file="${self-documenting_exception.dll}" todir="${build_classdir}" />
    <copy file="${object_factory.dll}" todir="${build_classdir}" />
    <copy file="${object_factory_configuration_api_plugin.dll}" todir="${build_classdir}" />
    <copy file="${log4net.dll}" todir="${build_classdir}" />
    <copy file="${set_utility.dll}" todir="${build_classdir}" />
    <copy file="${system_addin.dll}" todir="${build_classdir}" />
    <copy file="${system_addin_contract.dll}" todir="${build_classdir}" />

    <!--Copy dependencies for addins-->
    <copy file="${exception_manager.dll}" todir="${build_testaddins}\MyAggregator" />
    <copy file="${exception_manager.dll}" todir="${build_testaddins}\MyIndexer" />
    <copy file="${exception_manager.dll}" todir="${build_testaddins}\MyQueryParser" />
    <copy file="${self-documenting_exception.dll}" todir="${build_testaddins}\MyAggregator" />
    <copy file="${self-documenting_exception.dll}" todir="${build_testaddins}\MyIndexer" />
    <copy file="${self-documenting_exception.dll}" todir="${build_testaddins}\MyQueryParser" />

    <copy file="${configuration_api.dll}" todir="${build_addinsideadapters}" />
    <copy file="${build_classdir}\${namespace_file}.Common.dll" todir="${build_addinroot}\addinsideadapters" />
    <copy file="${configuration_api.dll}" todir="${build_addinroot}\addinviews" />
    <copy file="${build_classdir}\${namespace_file}.Common.dll" todir="${build_addinroot}\addinviews" />
    <copy file="${configuration_api.dll}" todir="${build_addinroot}\contracts" />
    <copy file="${build_classdir}\${namespace_file}.Common.dll" todir="${build_addinroot}\contracts" />
    <copy file="${configuration_api.dll}" todir="${build_addinroot}\hostsideadapters" />
    <copy file="${build_classdir}\${namespace_file}.Common.dll" todir="${build_addinroot}\hostsideadapters" />
  </target>

  <target name="test" depends="compile_tests,copy_dependencies">
    <mkdir dir="${testlogdir}"/>

    <echo message="Please make sure that nunit-console is in your path."/>
    <echo message="This file can be found in the NUnit bin directory."/>

    <nunit2 verbose="true">
      <formatter type="Plain" usefile="true" outputdir="${testlogdir}" extension=".log"/>
      <test assemblyname="${build_classdir}\${namespace_file}.DeveloperTest.dll"/>
      <test assemblyname="${build_classdir}\${namespace_file}.AccuracyTest.dll"/>
      <test assemblyname="${build_classdir}\${namespace_file}.FailureTest.dll"/>
      <test assemblyname="${build_classdir}\${namespace_file}.StressTest.dll"/>
    </nunit2>
  </target>


  <target name="dist" depends="compile_tests">
    <mkdir dir="${dist_bin}/${component_path}"/>

    <mkdir dir="dist_temp_dir"/>
    <copy todir="dist_temp_dir" flatten="true">
      <fileset basedir="${build_classdir}" defaultexcludes="true">
        <include name="**/*.dll"/>
        <exclude name="**/*Test.dll"/>
        <exclude name="AddIns/**/*.dll"/>
      </fileset>
    </copy>

    <zip zipfile="${component.zip}">
      <fileset basedir="dist_temp_dir" defaultexcludes="true">
        <include name="**/*.dll"/>
      </fileset>
    </zip>

    <delete dir="dist_temp_dir"/>
  </target>


  <target name="generate_docs" />
  <!-- depends="msdn" -->


  <target name="deploy" depends="dist">
  </target>

  <target name="main" depends="deploy,test">
  </target>


  <target name="nunitreport" depends="test">
    <!-- By default the report is in english, format is noframes by default -->
    <mkdir dir="${testdocsresult_dir}"/>
    <nunit2report format="frames" opendesc="yes"  todir="${testdocsresult_dir}"  >
      <fileset>
        <include name="${TestOutputXml}" />
      </fileset>
      <summaries>
        <include name="${build_docsdir}\${namespace_file}.Test.xml" />
      </summaries>
    </nunit2report>

    <echo message="NUnit frame report generated."/>
  </target>

  <target name="ncoverreport" description="Code coverage test run." depends="compile_tests">

    <echo message="Starting NUnit code coverage run..."/>

    <exec program="${NCoverConsole}"
                        commandline="&quot;${NunitConsole}&quot; ${build_classdir}\${namespace_file}.DeveloperTest.dll /xml=${CoverageNunitXml} //l ${CoverageLogFile} //x ${CoverageOutputXml} //ea ${namespace_file}.CoverageExcludeAttribute"
                        workingdir="." failonerror="true" verbose="true">
    </exec>
    <!-- copy stylesheet -->
    <copy file="${NCoverStyle}" tofile="${CoverageOutputStyleSheet}" />

    <echo message="NCover report generated."/>
  </target>

  <target name="msdn" depends="compile_tests,copy_dependencies">
    <mkdir dir="${build_msdndir}"/>
    <echo message="Requires Microsoft's HTML Help Compiler (hhc.exe) is in your path."/>
    <ndoc verbose="true">
      <assemblies>
        <include name="${build_classdir}\${namespace_file}.DeveloperTest.dll"/>
        <include name="${build_classdir}\${namespace_file}.AccuracyTest.dll"/>
        <include name="${build_classdir}\${namespace_file}.FailureTest.dll"/>
        <include name="${build_classdir}\${namespace_file}.StressTest.dll"/>
      </assemblies>
      <summaries >
        <include name="${build_classdir}\${namespace_file}.DeveloperTest.xml"/>
        <include name="${build_classdir}\${namespace_file}.AccuracyTest.xml"/>
        <include name="${build_classdir}\${namespace_file}.FailureTest.xml"/>
        <include name="${build_classdir}\${namespace_file}.StressTest.xml"/>
      </summaries>
      <documenters>
        <documenter name="MSDN">
          <property name="OutputDirectory" value="${build_msdndir}" />
          <property name="HtmlHelpName" value="${distfilename}" />
          <property name="HtmlHelpCompilerFilename" value="hhc.exe" />
          <property name="IncludeFavorites" value="False" />
          <property name="Title" value="${component}" />
          <property name="SplitTOCs" value="False" />
          <property name="DefaulTOC" value="" />
          <property name="ShowVisualBasic" value="False" />
          <property name="ShowMissingSummaries" value="False" />
          <property name="ShowMissingRemarks" value="False" />
          <property name="ShowMissingParams" value="False" />
          <property name="ShowMissingReturns" value="False" />
          <property name="ShowMissingValues" value="False" />
          <property name="DocumentInternals" value="False" />
          <property name="DocumentProtected" value="False" />
          <property name="DocumentPrivates" value="False" />
          <property name="DocumentEmptyNamespaces" value="False" />
          <property name="IncludeAssemblyVersion" value="True" />
          <property name="CopyrightText" value="${copyright}" />
          <property name="CopyrightHref" value="" />
          <property name="AutoDocumentConstructors" value="True" />
        </documenter>
      </documenters>
    </ndoc>
  </target>

</project>
