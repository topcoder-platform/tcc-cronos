<project name="Override Macrodef Standard Behaviour Import" basedir=".">
    <!-- macrodef override definition in order to change the standard behaviour from
         build.xml/build_dist.xml
     -->
  <property name="component.conf.dir" value="${build_distdir}/conf" />
  <property name="component.ejb.dir" value="${build_distdir}/application/ejb" />
  <property name="component.ejb.jar" value="${component.ejb.dir}/${distfilename}.jar" />
  <property name="component.ear.dir" value="${build_distdir}/application/ear" />
  <property name="component.ear" value="${component.ear.dir}/${distfilename}.ear" />
  <property name="package.dir" value="${builddir}/package" />

  <target name="package.ejb" depends="compile, compile_tests">
    <delete dir="${package.dir}" />

    <copy todir="${package.dir}" overwrite="true">
      <fileset dir="${build_classdir}">
        <include name="**/*" />
      </fileset>
    </copy>

    <copy todir="${package.dir}" overwrite="true">
      <fileset dir="${build_testclassdir}">
        <include name="**/*" />
      </fileset>
    </copy>

    <copy todir="${package.dir}" overwrite="true">
      <fileset dir="${testfiles}">
        <include name="users.properties" />
        <include name="roles.properties" />
      </fileset>
    </copy>

    <mkdir dir="${component.ejb.dir}" />
    <jar basedir="${package.dir}" destfile="${component.ejb.jar}">
      <metainf dir="${testfiles}/ejb">
      </metainf>
    </jar>
  </target>

  <target name="deployEAR" depends="package.ejb">
    <delete file="${component.ear}" failonerror="false" />

    <mkdir dir="${component.ear.dir}" />

    <!-- copy informix driver to jboss -->
    <copy file="${jdbc.informix.jar}" todir="${jboss_home}/server/${jboss_config_name}/lib" />
  
    <copy todir="${component.ear.dir}" overwrite="true">
        <fileset dir="${basedir}/test_reflib">
            <include name="**/*.jar"/>
        </fileset>
    </copy>

    <copy file="${component.ejb.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${typesafe_enum.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${jboss_login_module.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${base_exception.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${logging_wrapper.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${user_group_manager.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${object_formatter.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${logging_wrapper.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${configuration_api.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${configuration_persistence.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${configuration_manager.jar}" todir="${component.ear.dir}" overwrite="true" />
    <copy file="${testfiles}/lib/mock.jar" todir="${component.ear.dir}" overwrite="true" />
    
    <copy file="${testfiles}/informix-ds.xml" todir="${component.ear.dir}" overwrite="true" />
    <ear earfile="${component.ear}" basedir="${component.ear.dir}" appxml="${testfiles}/ear/application.xml" />

    <!-- deploy the genereated ear file -->
    <copy file="${component.ear}" todir="${jboss_home}/server/${jboss_config_name}/deploy" />
  </target>

  <target name="undeployEAR">
    <delete file="${jboss_home}/server/${jboss_config_name}/deploy/${distfilename}.ear" />
  </target>     
</project>
