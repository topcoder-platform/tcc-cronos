<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" verticalScrollPolicy="off">
	<mx:Script>
		<![CDATA[
			import mx.controls.Button;
			import mx.core.UIComponent;
			import mx.validators.Validator;
			import mx.validators.ValidationResult;
			import mx.controls.Alert;
			import mx.events.ValidationResultEvent;
			[Embed(source="../assets/verisign.png")]
			[Bindable]private var sign:Class;
			public function saveData():int {
				var inputs:Array = [cardNum, cardname, address, city, state, code, country, phone, email];
				var model:Model = Model.instance;
				if (byPass.selected) {
					for each (var target:TextInput in inputs) {
						removeValidate(target);
					} 
					
					if (doValidate(order)) {
						model.purchaseOrder = order.text;
						return 3;
					} else {
						showErrorMsg();
						return -1;
					}
				}  else {
					removeValidate(order);
					var result:Boolean = true;
					for each (var item:TextInput in inputs) {
						result = result && doValidate(item);
						model[item.id] = item.text;
					}
					model.cardType = cardTypeCombo.selectedItem.data;
					model.cardExpDateStr = month.value + "/" + year.value;
					if (result) {
						return 2;
					} else {
						showErrorMsg();
						return -1;
					}
				} 
				return true;
			}
			
			private function showErrorMsg():void {
				Alert.show("Some fields are missing. Please check!");
			}
			
			private function removeValidate(target:TextInput):void {
				if (target.text.length <= 0) {
					target.text = "12";
					doValidate(target);
					commonValidator.source = null;
					target.text = "";
				}
			}
			
			private function doValidate(target:TextInput):Boolean {
				commonValidator.source = target;
				var errors:Array = Validator.validateAll([commonValidator]);

				if (errors && errors.length > 0) {
					return false;
				} else {
					return true;
				}
			}
			
			private function checkMonth():void {
				if (month.value > 12) {
					month.value = 1;
					year.value++;
				} else if (month.value < 1) {
					month.value = 12;
					year.value--;
				}
			}
			
			
		]]>
	</mx:Script>
	<mx:StringValidator id="commonValidator" property="text"  required="true"/>
	<mx:HBox width="100%">
		<mx:VBox width="100%">
			<mx:Label text="Credit Card Information" styleName="header" />
			<mx:HBox width="100%">
				<mx:VBox width="100">
					<mx:Label text="Card Number:" styleName="contentBlack" />
					<mx:Label text="Card Type:" styleName="contentBlack" />
					<mx:Label text="Expiration Date:" styleName="contentBlack" />
				</mx:VBox>
				<mx:VBox width="100%">
					<mx:TextInput id="cardNum" width="100%" height="20" />
					<mx:ComboBox width="100%" height="20" styleName="combobox" id="cardTypeCombo">
						<mx:dataProvider>
	                        <mx:Object label="Visa" data="Visa"/>
							<mx:Object label="MasterCard" data="MasterCard"/>
						</mx:dataProvider>
					</mx:ComboBox>
					<mx:HBox width="100%">
						<mx:NumericStepper minimum="0" maximum="13" value="12" id="month" textAlign="left"
								height="25" width="70" styleName="NumericStepper" valueCommit="checkMonth()" />
						<mx:Text text="/" />
						<mx:NumericStepper minimum="1800" maximum="2800" value="2008" id="year"
								height="25" width="70" styleName="NumericStepper" />
					</mx:HBox>
				</mx:VBox>
				<mx:VBox width="10" height="100%" />
			</mx:HBox>
		</mx:VBox>
		<mx:VBox width="100%">
			<mx:Label text="Billing Information" styleName="header" />
			<mx:HBox width="100%">
				<mx:VBox width="100" height="100%" styleName="contentBlack" verticalGap="13" >
					<mx:Label text="Name on Card:" height="20" />
					<mx:Label text="Address:" height="20" />
					<mx:Label text="City:" height="20" />
					<mx:Label text="State:" height="20" />
					<mx:Label text="Zip Code:" height="20" />
					<mx:Label text="Country:" height="20" />
					<mx:Label text="Phone:" height="20" />
					<mx:Label text="Email:" height="20" />
				</mx:VBox>
				<mx:VBox width="100%" height="100%" verticalGap="13" >
					<mx:TextInput id="cardname" width="100%" height="20" />
					<mx:TextInput id="address" width="100%" height="20" />
					<mx:TextInput id="city" width="100%" height="20" />
					<mx:TextInput id="state" width="100%" height="20" />
					<mx:TextInput id="code" width="100%" height="20" />
					<mx:TextInput id="country" width="100%" height="20" />
					<mx:TextInput id="phone" width="100%" height="20" />
					<mx:TextInput id="email" width="100%" height="20" />
				</mx:VBox>
				<mx:VBox width="10" height="100%" styleName="contentBlack" fontSize="18" verticalGap="13" >
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
					<mx:Label text="*" height="20" />
				</mx:VBox>
			</mx:HBox>
		</mx:VBox>
		<mx:VBox width="100%">
			<mx:Label text="Other Payment Options" styleName="header" />
			<mx:VBox width="100%" height="100%" borderStyle="solid" 
					paddingLeft="10" paddingTop="10" paddingBottom="10" paddingRight="19">
				<mx:CheckBox id="byPass" selected="false" label="Bypass Credit Card Payment"
						styleName="content" />
				<mx:HBox width="100%">
					<mx:Label text="Purchase Order #" styleName="content" />
					<mx:TextInput id="order" width="100%" height="20" />
				</mx:HBox>
				<mx:HBox>
					<mx:Text text="For invoiced clients only. To learn more. " fontSize="11"
							fontWeight="normal" styleName="contentGrey" />
					<mx:LinkButton label="click here." />
				</mx:HBox>
			</mx:VBox>
			<mx:HBox width="100%">
				<mx:Label text="* Required Field" styleName="normalText" />
				<mx:Spacer width="100%" />
				<mx:Image source="{sign}" />
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>
</mx:VBox>
